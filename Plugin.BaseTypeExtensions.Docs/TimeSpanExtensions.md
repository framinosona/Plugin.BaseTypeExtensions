# ‚è∞ TimeSpanExtensions

Provides comprehensive operations and formatting for TimeSpan objects.

## Overview

The `TimeSpanExtensions` class offers utilities for TimeSpan manipulation, formatting, arithmetic operations, and human-readable representations.

## Formatting Methods

### Human-Readable Formatting

#### `ToReadableString(TimeSpan timeSpan)`
Converts TimeSpan to a concise, readable string format.

```csharp\nTimeSpan.FromDays(1).ToReadableString();         // \"1d\"\nTimeSpan.FromHours(2).ToReadableString();        // \"2h\"\nTimeSpan.FromMinutes(30).ToReadableString();     // \"30m\"\nTimeSpan.FromSeconds(45).ToReadableString();     // \"45s\"\nTimeSpan.FromMilliseconds(500).ToReadableString(); // \"500ms\"\n\n// Complex durations\nTimeSpan.FromHours(25).ToReadableString();       // \"1d 1h\"\nnew TimeSpan(1, 2, 30, 45).ToReadableString();   // \"1d 2h 30m 45s\"\n```\n\n#### `ToHumanReadable(TimeSpan timeSpan)`\nConverts TimeSpan to a detailed, human-friendly string.\n\n```csharp\nTimeSpan.FromDays(1).ToHumanReadable();          // \"1 day\"\nTimeSpan.FromDays(3).ToHumanReadable();          // \"3 days\"\nTimeSpan.FromHours(1).ToHumanReadable();         // \"1 hour\"\nTimeSpan.FromMinutes(30).ToHumanReadable();      // \"30 minutes\"\n\n// Complex durations with proper pluralization\nnew TimeSpan(2, 3, 30, 0).ToHumanReadable();     // \"2 days, 3 hours, 30 minutes\"\nnew TimeSpan(0, 1, 1, 1).ToHumanReadable();      // \"1 hour, 1 minute, 1 second\"\n```\n\n### Compact Formatting\n\n#### `ToCompactString(TimeSpan timeSpan)`\nCreates ultra-compact string representation.\n\n```csharp\nTimeSpan.FromHours(2.5).ToCompactString();       // \"2.5h\"\nTimeSpan.FromMinutes(90).ToCompactString();      // \"1.5h\"\nTimeSpan.FromSeconds(3661).ToCompactString();    // \"1h 1m 1s\"\n```\n\n## Arithmetic Operations\n\n### Multiplication and Division\n\n#### `Multiply(TimeSpan timeSpan, double multiplier)`\nMultiplies TimeSpan by a factor.\n\n```csharp\nvar duration = TimeSpan.FromHours(2);\nvar doubled = duration.Multiply(2.0);            // 4 hours\nvar halved = duration.Multiply(0.5);             // 1 hour\nvar extended = duration.Multiply(1.5);           // 3 hours\n```\n\n#### `Divide(TimeSpan timeSpan, double divisor)`\nDivides TimeSpan by a factor.\n\n```csharp\nvar duration = TimeSpan.FromHours(6);\nvar half = duration.Divide(2.0);                 // 3 hours\nvar third = duration.Divide(3.0);                // 2 hours\n```\n\n### Percentage Operations\n\n#### `Percentage(TimeSpan timeSpan, double percentage)`\nCalculates percentage of TimeSpan.\n\n```csharp\nvar fullDuration = TimeSpan.FromHours(8);\nvar quarter = fullDuration.Percentage(25.0);     // 2 hours (25% of 8 hours)\nvar half = fullDuration.Percentage(50.0);        // 4 hours\nvar oneAndHalf = fullDuration.Percentage(150.0); // 12 hours\n```\n\n## Rounding Operations\n\n### Time Rounding\n\n#### `RoundToNearest(TimeSpan timeSpan, TimeSpan interval)`\nRounds TimeSpan to nearest interval.\n\n```csharp\nvar time = TimeSpan.FromMinutes(37);\nvar rounded = time.RoundToNearest(TimeSpan.FromMinutes(15)); // 30 minutes\n\nvar precise = TimeSpan.FromSeconds(127);\nvar roundedMin = precise.RoundToNearest(TimeSpan.FromMinutes(1)); // 2 minutes\n```\n\n#### `RoundUp(TimeSpan timeSpan, TimeSpan interval)`\nRounds TimeSpan up to next interval.\n\n```csharp\nvar time = TimeSpan.FromMinutes(31);\nvar roundedUp = time.RoundUp(TimeSpan.FromMinutes(15)); // 45 minutes\n\nvar billing = TimeSpan.FromMinutes(1);\nvar billableHour = billing.RoundUp(TimeSpan.FromHours(1)); // 1 hour\n```\n\n#### `RoundDown(TimeSpan timeSpan, TimeSpan interval)`\nRounds TimeSpan down to previous interval.\n\n```csharp\nvar time = TimeSpan.FromMinutes(44);\nvar roundedDown = time.RoundDown(TimeSpan.FromMinutes(15)); // 30 minutes\n```\n\n## Conversion Methods\n\n### Unit Conversions\n\n#### `ToApproximateHumanString(TimeSpan timeSpan)`\nConverts to approximate human-readable format.\n\n```csharp\nTimeSpan.FromDays(365).ToApproximateHumanString(); // \"1 year\"\nTimeSpan.FromDays(45).ToApproximateHumanString();  // \"1 month\"\nTimeSpan.FromDays(8).ToApproximateHumanString();   // \"1 week\"\nTimeSpan.FromHours(25).ToApproximateHumanString(); // \"1 day\"\n```\n\n### Precision Methods\n\n#### `TruncateToSeconds(TimeSpan timeSpan)`\nRemoves millisecond precision.\n\n```csharp\nvar precise = TimeSpan.FromMilliseconds(45789);\nvar seconds = precise.TruncateToSeconds(); // 45 seconds (no milliseconds)\n```\n\n#### `TruncateToMinutes(TimeSpan timeSpan)`\nRemoves second and millisecond precision.\n\n```csharp\nvar precise = new TimeSpan(0, 2, 30, 45, 123);\nvar minutes = precise.TruncateToMinutes(); // 2 hours, 30 minutes\n```\n\n## Practical Applications\n\n### Progress Tracking\n\n```csharp\npublic class ProgressTracker\n{\n    private readonly Stopwatch _stopwatch = new();\n    private readonly TimeSpan _estimatedDuration;\n    \n    public ProgressTracker(TimeSpan estimatedDuration)\n    {\n        _estimatedDuration = estimatedDuration;\n        _stopwatch.Start();\n    }\n    \n    public string GetProgressString()\n    {\n        var elapsed = _stopwatch.Elapsed;\n        var remaining = _estimatedDuration - elapsed;\n        \n        if (remaining < TimeSpan.Zero) remaining = TimeSpan.Zero;\n        \n        return $\"Elapsed: {elapsed.ToReadableString()}, \" +\n               $\"Remaining: {remaining.ToReadableString()}\";\n    }\n    \n    public double GetProgressPercentage()\n    {\n        var elapsed = _stopwatch.Elapsed;\n        return Math.Min(100.0, (elapsed.TotalMilliseconds / _estimatedDuration.TotalMilliseconds) * 100.0);\n    }\n}\n```\n\n### Billing and Time Tracking\n\n```csharp\npublic class TimeEntry\n{\n    public DateTime Start { get; set; }\n    public DateTime End { get; set; }\n    public TimeSpan Duration => End - Start;\n    \n    public TimeSpan BillableDuration(TimeSpan minimumIncrement = default)\n    {\n        var increment = minimumIncrement == default \n            ? TimeSpan.FromMinutes(15) \n            : minimumIncrement;\n            \n        return Duration.RoundUp(increment);\n    }\n    \n    public string GetDurationDisplay()\n    {\n        return Duration.ToHumanReadable();\n    }\n    \n    public decimal CalculateBilling(decimal hourlyRate)\n    {\n        var billableHours = (decimal)BillableDuration().TotalHours;\n        return billableHours * hourlyRate;\n    }\n}\n```\n\n### Performance Monitoring\n\n```csharp\npublic class PerformanceMetrics\n{\n    private readonly List<TimeSpan> _measurements = new();\n    \n    public void AddMeasurement(TimeSpan duration)\n    {\n        _measurements.Add(duration);\n    }\n    \n    public TimeSpan AverageDuration()\n    {\n        if (_measurements.Count == 0) return TimeSpan.Zero;\n        \n        var totalTicks = _measurements.Sum(m => m.Ticks);\n        return new TimeSpan(totalTicks / _measurements.Count);\n    }\n    \n    public TimeSpan MedianDuration()\n    {\n        if (_measurements.Count == 0) return TimeSpan.Zero;\n        \n        var sorted = _measurements.OrderBy(m => m.Ticks).ToList();\n        var middle = sorted.Count / 2;\n        \n        return sorted.Count % 2 == 0\n            ? TimeSpan.FromTicks((sorted[middle - 1].Ticks + sorted[middle].Ticks) / 2)\n            : sorted[middle];\n    }\n    \n    public string GetSummary()\n    {\n        return $\"Count: {_measurements.Count}, \" +\n               $\"Average: {AverageDuration().ToReadableString()}, \" +\n               $\"Median: {MedianDuration().ToReadableString()}\";\n    }\n}\n```\n\n### Schedule Management\n\n```csharp\npublic class MeetingScheduler\n{\n    private readonly TimeSpan _standardMeetingLength = TimeSpan.FromMinutes(30);\n    \n    public TimeSpan CalculateMeetingDuration(TimeSpan requestedDuration)\n    {\n        // Round up to nearest 15-minute increment\n        return requestedDuration.RoundUp(TimeSpan.FromMinutes(15));\n    }\n    \n    public string FormatMeetingDuration(TimeSpan duration)\n    {\n        // Use human-readable format for meeting invites\n        return duration.ToHumanReadable();\n    }\n    \n    public TimeSpan CalculateBufferTime(TimeSpan meetingDuration)\n    {\n        // 10% buffer time, minimum 5 minutes\n        var buffer = meetingDuration.Percentage(10.0);\n        return buffer < TimeSpan.FromMinutes(5) \n            ? TimeSpan.FromMinutes(5) \n            : buffer;\n    }\n}\n```\n\n## Configuration and Settings\n\n### Timeout Management\n\n```csharp\npublic class TimeoutConfiguration\n{\n    public TimeSpan DefaultTimeout { get; set; } = TimeSpan.FromSeconds(30);\n    public TimeSpan LongOperationTimeout { get; set; } = TimeSpan.FromMinutes(5);\n    \n    public TimeSpan GetScaledTimeout(double scaleFactor)\n    {\n        return DefaultTimeout.Multiply(scaleFactor);\n    }\n    \n    public string GetTimeoutDisplayString()\n    {\n        return $\"Default: {DefaultTimeout.ToReadableString()}, \" +\n               $\"Long: {LongOperationTimeout.ToReadableString()}\";\n    }\n}\n```\n\n## Performance Considerations\n\n- All methods use `MethodImpl(MethodImplOptions.AggressiveInlining)` for performance\n- String formatting methods create minimal allocations\n- Arithmetic operations preserve precision where possible\n- Rounding operations use efficient tick-based calculations\n\n## Thread Safety\n\n- All extension methods are thread-safe (no shared state)\n- TimeSpan is an immutable value type\n- Safe for concurrent usage across multiple threads\n\n## Best Practices\n\n1. **Choose Appropriate Formatting**: Use `ToReadableString()` for logs, `ToHumanReadable()` for UI\n2. **Round Appropriately**: Consider business rules when rounding time values\n3. **Handle Edge Cases**: Account for negative TimeSpan values\n4. **Use Meaningful Intervals**: Choose rounding intervals that make business sense\n5. **Performance Monitoring**: Use TimeSpan extensions for consistent time formatting in metrics
